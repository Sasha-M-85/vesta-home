
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Список клиентов</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    th, td { border: 1px solid #999; padding: 8px; text-align: left; }
    th { background: #eee; }
    input[type="text"] { margin: 5px; padding: 6px; width: 200px; }
    select { padding: 6px; }
    button { padding: 6px 10px; margin-left: 5px; }
    nav { margin-bottom: 20px; }
    .delete-button { color: red; cursor: pointer; }
  </style>
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

    const supabase = createClient(
      'https://rincxoalnhfsnwgwxrfb.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'
    );

    const nameInput = document.getElementById('nameInput');
    const phoneInput = document.getElementById('phoneInput');
    const clientsTable = document.getElementById('clientsBody');
    const searchInput = document.getElementById('searchInput');
    const searchBy = document.getElementById('searchBy');

    async function loadClients() {
      let { data: clients, error } = await supabase.from('clients').select('*');
      if (error) {
        console.error('Ошибка загрузки клиентов:', error);
        return;
      }

      clients.sort((a, b) => a.name.localeCompare(b.name));
      displayClients(clients);
    }

    function displayClients(clients) {
      clientsTable.innerHTML = '';
      clients.forEach(client => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${client.id}</td>
          <td>${client.name}</td>
          <td>${client.phone}</td>
          <td>${new Date(client.created_at).toLocaleString()}</td>
          <td><span class="delete-button" onclick="deleteClient(${client.id})">Удалить</span></td>
        `;
        clientsTable.appendChild(row);
      });
    }

    document.getElementById('addBtn').addEventListener('click', async () => {
      const name = nameInput.value.trim();
      const phone = phoneInput.value.trim();
      if (!name || !phone) return alert("Введите имя и телефон");

      await supabase.from('clients').insert([{ name, phone }]);
      nameInput.value = '';
      phoneInput.value = '';
      await loadClients();
    });

    window.deleteClient = async (id) => {
      await supabase.from('clients').delete().eq('id', id);
      await loadClients();
    };

    searchInput.addEventListener('input', async () => {
      const term = searchInput.value.trim().toLowerCase();
      const by = searchBy.value;
      let { data: clients } = await supabase.from('clients').select('*');
      clients.sort((a, b) => a.name.localeCompare(b.name));
      const filtered = clients.filter(c => (c[by] || '').toLowerCase().includes(term));
      displayClients(filtered);
    });

    loadClients();
  </script>
</head>
<body>
  <nav><a href="home.html">На главную</a></nav>

  <h1>Список клиентов</h1>

  <input id="nameInput" type="text" placeholder="Имя клиента" />
  <input id="phoneInput" type="text" placeholder="Телефон клиента" />
  <button id="addBtn">Добавить клиента</button>

  <br/><br/>

  <label>Поиск:
    <input id="searchInput" type="text" placeholder="Поиск..." />
    <select id="searchBy">
      <option value="name">по имени</option>
      <option value="phone">по телефону</option>
    </select>
  </label>

  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Имя</th>
        <th>Телефон</th>
        <th>Создан</th>
        <th></th>
      </tr>
    </thead>
    <tbody id="clientsBody"></tbody>
  </table>
</body>
</html>
